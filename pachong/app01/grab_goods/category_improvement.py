"""
å•†å“åˆ†ç±»å‡†ç¡®åº¦æ”¹è¿›æ–¹æ¡ˆ
"""

# æ”¹è¿›çš„åˆ†ç±»å…³é”®è¯æ˜ å°„ - æ·»åŠ æƒé‡å’Œæ’é™¤è¯
IMPROVED_CATEGORY_KEYWORDS = {
    'æ‰‹æœºæ•°ç ': {
        'keywords': ['æ‰‹æœº', 'iPhone', 'åä¸º', 'å°ç±³', 'OPPO', 'vivo', 'ä¸‰æ˜Ÿ', 'é­…æ—', 'ä¸€åŠ ', 'realme', 'iQOO', 'è£è€€', 'çº¢ç±³', 'è‹¹æœ', 'æ™ºèƒ½æ‰‹æœº', 'å¹³æ¿', 'iPad', 'ç”µè„‘', 'ç¬”è®°æœ¬', 'MacBook', 'ThinkPad', 'æˆ´å°”', 'è”æƒ³', 'åç¡•', 'æƒ æ™®', 'æ•°ç ', 'ç›¸æœº', 'å•å', 'å¾®å•', 'æ‘„åƒæœº', 'è€³æœº', 'éŸ³å“', 'è“ç‰™è€³æœº', 'æ— çº¿è€³æœº', 'å……ç”µå™¨', 'æ•°æ®çº¿', 'å……ç”µå®', 'ç§»åŠ¨ç”µæº', 'æ™ºèƒ½æ‰‹è¡¨', 'æ‰‹ç¯', 'æ•°ç äº§å“'],
        'exclude': ['æ‰‹æœºå£³', 'æ‰‹æœºè†œ', 'æ‰‹æœºæ”¯æ¶', 'æ‰‹æœºå¥—', 'æ‰‹æœºè´´è†œ', 'æ‰‹æœºä¿æŠ¤å¥—'],
        'weight': 1.0
    },
    'æœè£…é‹å¸½': {
        'keywords': ['è¡£æœ', 'ä¸Šè¡£', 'è£¤å­', 'è£™å­', 'å¤–å¥—', 'ç¾½ç»’æœ', 'æ£‰æœ', 'å«è¡£', 'Tæ¤', 'è¡¬è¡«', 'ç‰›ä»”è£¤', 'è¿åŠ¨è£¤', 'ä¼‘é—²è£¤', 'è¥¿è£…', 'ç¤¼æœ', 'å†…è¡£', 'å†…è£¤', 'è¢œå­', 'é‹å­', 'è¿åŠ¨é‹', 'è·‘é‹', 'ç¯®çƒé‹', 'è¶³çƒé‹', 'å¸†å¸ƒé‹', 'çš®é‹', 'å‡‰é‹', 'æ‹–é‹', 'é´å­', 'å¸½å­', 'æ£’çƒå¸½', 'é¸­èˆŒå¸½', 'æ¯›çº¿å¸½', 'å›´å·¾', 'æ‰‹å¥—', 'è…°å¸¦', 'åŒ…åŒ…', 'èƒŒåŒ…', 'æ‰‹æåŒ…', 'é’±åŒ…', 'åŒè‚©åŒ…', 'æœè£…', 'ç”·è£…', 'å¥³è£…', 'ç«¥è£…', 'æ—¶å°š'],
        'exclude': ['è¡£æ¶', 'æ™¾è¡£æ¶', 'è¡£æŸœ', 'é‹æŸœ', 'è¡£å¸½æ¶'],
        'weight': 1.0
    },
    'è¿åŠ¨æˆ·å¤–': {
        'keywords': ['è¿åŠ¨', 'å¥èº«', 'è·‘æ­¥', 'ç¯®çƒ', 'è¶³çƒ', 'ç¾½æ¯›çƒ', 'ä¹’ä¹“çƒ', 'ç½‘çƒ', 'æ¸¸æ³³', 'ç‘œä¼½', 'æˆ·å¤–', 'ç™»å±±', 'å¾’æ­¥', 'éœ²è¥', 'é’“é±¼', 'éª‘è¡Œ', 'æ»‘é›ª', 'æ»‘æ¿', 'è½®æ»‘', 'å¥èº«å™¨æ', 'å“‘é“ƒ', 'è·‘æ­¥æœº', 'åŠ¨æ„Ÿå•è½¦', 'ç‘œä¼½å«', 'è¿åŠ¨æœ', 'è¿åŠ¨è£¤', 'è¿åŠ¨è¢œ', 'æŠ¤å…·', 'æŠ¤è†', 'æŠ¤è…•', 'æŠ¤è‚˜', 'å¤´ç›”', 'æ‰‹å¥—', 'è¿åŠ¨è£…å¤‡', 'æˆ·å¤–è£…å¤‡', 'ä½“è‚²ç”¨å“'],
        'exclude': ['è¿åŠ¨é¥®æ–™', 'è¿åŠ¨è¥å…»å“', 'è¿åŠ¨è¡¥å‰‚'],
        'weight': 1.2  # è¿åŠ¨å“ç‰Œå•†å“æƒé‡æ›´é«˜
    },
    'å®¶å±…ç”Ÿæ´»': {
        'keywords': ['å®¶å…·', 'æ²™å‘', 'åºŠ', 'æ¡Œå­', 'æ¤…å­', 'æŸœå­', 'è¡£æŸœ', 'ä¹¦æŸœ', 'é‹æŸœ', 'èŒ¶å‡ ', 'ç”µè§†æŸœ', 'é¤æ¡Œ', 'ä¹¦æ¡Œ', 'åŠå…¬æ¡Œ', 'åºŠå«', 'æ•å¤´', 'è¢«å­', 'åºŠå•', 'è¢«å¥—', 'æ•å¥—', 'æ¯›å·¾', 'æµ´å·¾', 'æµ´è¢', 'å®¶å±…', 'å®¶è£…', 'è£…é¥°', 'æ‘†ä»¶', 'èŠ±ç“¶', 'ç›¸æ¡†', 'åœ°æ¯¯', 'çª—å¸˜', 'ç¯å…·', 'å°ç¯', 'åŠç¯', 'å£ç¯', 'å¸é¡¶ç¯', 'å®¶å±…ç”¨å“'],
        'exclude': ['å®¶å…·æ¸…æ´å‰‚', 'å®¶å…·ç»´ä¿®', 'å®¶å…·å®‰è£…'],
        'weight': 1.0
    },
    'é£Ÿå“é¥®æ–™': {
        'keywords': ['é›¶é£Ÿ', 'é¥¼å¹²', 'è–¯ç‰‡', 'ç³–æœ', 'å·§å…‹åŠ›', 'åšæœ', 'ç“œå­', 'èŠ±ç”Ÿ', 'æ ¸æ¡ƒ', 'æä»', 'è…°æœ', 'å¼€å¿ƒæœ', 'é¥®æ–™', 'å¯ä¹', 'é›ªç¢§', 'æœæ±', 'å¥¶èŒ¶', 'å’–å•¡', 'èŒ¶', 'çŸ¿æ³‰æ°´', 'çº¯å‡€æ°´', 'ç‰›å¥¶', 'é…¸å¥¶', 'é¢åŒ…', 'è›‹ç³•', 'æœˆé¥¼', 'ç²½å­', 'æ–¹ä¾¿é¢', 'ç«è…¿è‚ ', 'ç½å¤´', 'è°ƒå‘³å“', 'é…±æ²¹', 'é†‹', 'ç›', 'ç³–', 'æ²¹', 'ç±³', 'é¢', 'é¢æ¡', 'é£Ÿå“', 'é›¶é£Ÿ', 'å°åƒ', 'é¥®å“'],
        'exclude': ['é£Ÿå“åŒ…è£…', 'é£Ÿå“åŠ å·¥', 'é£Ÿå“æ·»åŠ å‰‚'],
        'weight': 1.0
    },
    'æ¯å©´ç”¨å“': {
        'keywords': ['å°¿ä¸æ¹¿', 'çº¸å°¿è£¤', 'æ¹¿å·¾', 'å¥¶ç“¶', 'å¥¶å˜´', 'å¸å¥¶å™¨', 'å©´å„¿è½¦', 'å©´å„¿åºŠ', 'æ‘‡ç¯®', 'ç©å…·', 'ç§¯æœ¨', 'æ‹¼å›¾', 'æ¯›ç»’ç©å…·', 'ç›Šæ™ºç©å…·', 'æ—©æ•™', 'ç»˜æœ¬', 'æ•…äº‹ä¹¦', 'å©´å„¿æœ', 'è¿ä½“è¡£', 'çˆ¬æœ', 'å›´å˜´', 'å£æ°´å·¾', 'æ¶¦è‚¤éœ²', 'æŠ¤è‡€è†', 'æ¯å©´', 'å©´å„¿', 'å®å®', 'å„¿ç«¥', 'å¹¼å„¿', 'æ¯å©´ç”¨å“'],
        'exclude': ['æˆäººç”¨å“', 'æˆäººæœè£…', 'æˆäººç©å…·'],
        'weight': 1.0
    },
    'ç¾å¦†æŠ¤è‚¤': {
        'keywords': ['æŠ¤è‚¤å“', 'æ´—é¢å¥¶', 'çˆ½è‚¤æ°´', 'ç²¾åæ¶²', 'é¢éœœ', 'ä¹³æ¶²', 'çœ¼éœœ', 'é¢è†œ', 'é˜²æ™’éœœ', 'éš”ç¦»éœœ', 'ç²‰åº•æ¶²', 'BBéœœ', 'CCéœœ', 'é®ç‘•è†', 'æ•£ç²‰', 'å®šå¦†ç²‰', 'è…®çº¢', 'çœ¼å½±', 'çœ¼çº¿ç¬”', 'ç«æ¯›è†', 'çœ‰ç¬”', 'å£çº¢', 'å”‡è†', 'å”‡å½©', 'æŒ‡ç”²æ²¹', 'é¦™æ°´', 'æŠ¤å‘ç´ ', 'å‘è†œ', 'ç²¾æ²¹', 'ç¾å®¹ä»ª', 'åŒ–å¦†åˆ·', 'ç¾å¦†è›‹', 'ç¾å¦†', 'æŠ¤è‚¤', 'åŒ–å¦†å“', 'å½©å¦†'],
        'exclude': ['ç¾å®¹é™¢', 'ç¾å®¹æœåŠ¡', 'ç¾å®¹è®¾å¤‡'],
        'weight': 1.0
    },
    'å›¾ä¹¦éŸ³åƒ': {
        'keywords': ['å›¾ä¹¦', 'å°è¯´', 'æ–‡å­¦', 'å†å²', 'å“²å­¦', 'å¿ƒç†å­¦', 'ç»æµå­¦', 'ç®¡ç†å­¦', 'è®¡ç®—æœº', 'ç¼–ç¨‹', 'æŠ€æœ¯', 'æ•™æ', 'æ•™è¾…', 'è€ƒè¯•', 'è‹±è¯­', 'æ•°å­¦', 'è¯­æ–‡', 'ç‰©ç†', 'åŒ–å­¦', 'ç”Ÿç‰©', 'åœ°ç†', 'æ”¿æ²»', 'éŸ³ä¹', 'CD', 'DVD', 'è“å…‰', 'ç”µå½±', 'ç”µè§†å‰§', 'çºªå½•ç‰‡', 'åŠ¨ç”»', 'æ¸¸æˆ', 'æ‰‹æŸ„', 'é”®ç›˜', 'é¼ æ ‡', 'æ˜¾ç¤ºå™¨', 'éŸ³ç®±', 'ä¹¦ç±', 'æ‚å¿—', 'éŸ³åƒåˆ¶å“'],
        'exclude': ['æ¸¸æˆæœº', 'æ¸¸æˆè®¾å¤‡', 'æ¸¸æˆä¸»æœº'],
        'weight': 1.0
    },
    'æ±½è½¦ç”¨å“': {
        'keywords': ['æ±½è½¦', 'è½®èƒ', 'æœºæ²¹', 'æœºæ»¤', 'ç©ºæ»¤', 'æ±½æ»¤', 'åˆ¹è½¦ç‰‡', 'åˆ¹è½¦ç›˜', 'ç«èŠ±å¡', 'ç”µç“¶', 'è“„ç”µæ± ', 'é›¨åˆ·', 'é›¨åˆ®å™¨', 'è½¦ç¯', 'å¤§ç¯', 'å°¾ç¯', 'è½¬å‘ç¯', 'é›¾ç¯', 'è½¦è†œ', 'è´´è†œ', 'è„šå«', 'åº§å¥—', 'æ–¹å‘ç›˜å¥—', 'æŒ‚ä»¶', 'æ‘†ä»¶', 'å¯¼èˆª', 'è¡Œè½¦è®°å½•ä»ª', 'å€’è½¦é›·è¾¾', 'å€’è½¦å½±åƒ', 'è½¦è½½å……ç”µå™¨', 'è½¦è½½å†°ç®±', 'è½¦è½½å¸å°˜å™¨', 'æ±½è½¦é…ä»¶', 'æ±½é…'],
        'exclude': ['æ±½è½¦', 'æ‘©æ‰˜è½¦', 'ç”µåŠ¨è½¦', 'è‡ªè¡Œè½¦'],
        'weight': 1.0
    },
    'åŒ»è¯ä¿å¥': {
        'keywords': ['è¯å“', 'æ„Ÿå†’è¯', 'é€€çƒ§è¯', 'æ¶ˆç‚è¯', 'æ­¢ç—›è¯', 'ç»´ç”Ÿç´ ', 'é’™ç‰‡', 'é±¼æ²¹', 'è›‹ç™½ç²‰', 'ä¿å¥å“', 'è¥å…»å“', 'å‡è‚¥è¯', 'å‡è‚¥èŒ¶', 'å‡è‚¥äº§å“', 'åŒ»ç–—å™¨æ¢°', 'è¡€å‹è®¡', 'è¡€ç³–ä»ª', 'ä½“æ¸©è®¡', 'å¬è¯Šå™¨', 'æŒ‰æ‘©å™¨', 'æŒ‰æ‘©æ¤…', 'æŒ‰æ‘©å«', 'ç†ç–—ä»ª', 'è‰¾ç¸', 'æ‹”ç½', 'åˆ®ç—§', 'é’ˆç¸', 'ä¸­è¯', 'ä¸­è¯æ', 'ä¸­æˆè¯', 'è¥¿è¯', 'å¤„æ–¹è¯', 'éå¤„æ–¹è¯', 'åŒ»è¯', 'ä¿å¥', 'åŒ»ç–—'],
        'exclude': ['åŒ»é™¢', 'è¯Šæ‰€', 'åŒ»ç–—æœåŠ¡', 'åŒ»ç–—è®¾å¤‡'],
        'weight': 1.0
    }
}

# å“ç‰Œåˆ†ç±»æ˜ å°„
BRAND_CATEGORY_MAP = {
    'æ‰‹æœºæ•°ç ': ['è‹¹æœ', 'åä¸º', 'å°ç±³', 'OPPO', 'vivo', 'ä¸‰æ˜Ÿ', 'é­…æ—', 'ä¸€åŠ ', 'realme', 'iQOO', 'è£è€€', 'çº¢ç±³', 'è”æƒ³', 'æˆ´å°”', 'åç¡•', 'æƒ æ™®', 'ThinkPad', 'MacBook', 'iPad'],
    'è¿åŠ¨æˆ·å¤–': ['æå®', 'è€å…‹', 'é˜¿è¿ªè¾¾æ–¯', 'å®‰è¸', 'ç‰¹æ­¥', 'é¸¿æ˜Ÿå°”å…‹', 'åŒ¹å…‹', 'ä¹”ä¸¹', 'å½ªé©¬', 'æ–ä¹', 'åŒ¡å¨', 'ä¸‡æ–¯', 'æ–°ç™¾ä¼¦', 'æ–¯å‡¯å¥‡'],
    'ç¾å¦†æŠ¤è‚¤': ['å…°è”»', 'é›…è¯—å…°é»›', 'æ¬§è±é›…', 'èµ„ç”Ÿå ‚', 'SK-II', 'æµ·è“ä¹‹è°œ', 'å€©ç¢§', 'ç§‘é¢œæ°', 'æ‚¦è¯—é£åŸ', 'é›ªèŠ±ç§€'],
    'é£Ÿå“é¥®æ–™': ['å¯å£å¯ä¹', 'ç™¾äº‹å¯ä¹', 'å¨ƒå“ˆå“ˆ', 'å†œå¤«å±±æ³‰', 'åº·å¸ˆå‚…', 'ç»Ÿä¸€', 'è’™ç‰›', 'ä¼Šåˆ©', 'å…‰æ˜', 'ä¸‰å…ƒ'],
    'æ¯å©´ç”¨å“': ['èŠ±ç‹', 'å¸®å®é€‚', 'å¥½å¥‡', 'å¦ˆå’ªå®è´', 'è´äº²', 'é£åˆ©æµ¦', 'æ–°å®‰æ€¡', 'ç¾å¾·ä¹', 'å¥½å­©å­', 'è´è´æ€¡'],
    'å®¶å±…ç”Ÿæ´»': ['å®œå®¶', 'å…¨å‹', 'é¡¾å®¶', 'ç´¢è²äºš', 'æ¬§æ´¾', 'å¿—é‚¦', 'é‡‘ç‰Œ', 'çš®é˜¿è¯º', 'å¥½è±å®¢', 'å°šå“å®…é…'],
    'æ±½è½¦ç”¨å“': ['ç±³å…¶æ—', 'æ™®åˆ©å¸é€š', 'å›ºç‰¹å¼‚', 'é‚“ç¦„æ™®', 'é©¬ç‰Œ', 'å€è€åŠ›', 'ä½³é€š', 'ç²ç‘', 'æœé˜³', 'æ­£æ–°'],
    'åŒ»è¯ä¿å¥': ['åŒä»å ‚', 'äº‘å—ç™½è¯', 'ç‰‡ä»”ç™€', 'ä¸œé˜¿é˜¿èƒ¶', 'ä¹èŠå ‚', 'å¤ªæ', 'å“ˆè¯', 'ååŒ—åˆ¶è¯', 'ä¸œåŒ—åˆ¶è¯', 'æ–°ååˆ¶è¯']
}

def improved_category_recognition(title, brand=None):
    """
    æ”¹è¿›çš„å•†å“åˆ†ç±»è¯†åˆ«
    """
    if not title:
        return 'æœªåˆ†ç±»'
    
    title_lower = title.lower()
    
    # 1. å“ç‰Œä¼˜å…ˆåˆ†ç±»
    if brand:
        brand_lower = brand.lower()
        for category, brands in BRAND_CATEGORY_MAP.items():
            for brand_keyword in brands:
                if brand_keyword.lower() in brand_lower:
                    return category
    
    # 2. æ’é™¤è¯æ£€æŸ¥
    for category, config in IMPROVED_CATEGORY_KEYWORDS.items():
        for exclude_word in config['exclude']:
            if exclude_word.lower() in title_lower:
                return 'æœªåˆ†ç±»'  # å¦‚æœåŒ…å«æ’é™¤è¯ï¼Œç›´æ¥è¿”å›æœªåˆ†ç±»
    
    # 3. å…³é”®è¯è¯„åˆ†
    category_scores = {}
    
    for category, config in IMPROVED_CATEGORY_KEYWORDS.items():
        score = 0
        for keyword in config['keywords']:
            if keyword.lower() in title_lower:
                # å®Œæ•´åŒ¹é…åŠ åˆ†
                if keyword.lower() in title_lower.split():
                    score += 3
                else:
                    score += 1
        
        # åº”ç”¨æƒé‡
        score *= config['weight']
        
        if score > 0:
            category_scores[category] = score
    
    # 4. è¿”å›å¾—åˆ†æœ€é«˜çš„åˆ†ç±»
    if category_scores:
        best_category = max(category_scores.items(), key=lambda x: x[1])[0]
        return best_category
    
    return 'æœªåˆ†ç±»'

def test_improved_classification():
    """
    æµ‹è¯•æ”¹è¿›çš„åˆ†ç±»è¯†åˆ«
    """
    test_cases = [
        ("iPhone 14 Pro Max 256GB æ·±ç©ºé»‘è‰² æ™ºèƒ½æ‰‹æœº", "æ‰‹æœºæ•°ç "),
        ("æå®è¿åŠ¨é‹ç”·2024æ–°æ¬¾è·‘æ­¥é‹", "è¿åŠ¨æˆ·å¤–"),
        ("åä¸ºæ‰‹æœºå£³iPhone14ä¿æŠ¤å¥—", "æœªåˆ†ç±»"),  # åº”è¯¥è¢«æ’é™¤
        ("è€å…‹ç¯®çƒé‹Nike Air Jordan", "è¿åŠ¨æˆ·å¤–"),
        ("å°ç±³å¹³æ¿ç”µè„‘iPad Pro", "æ‰‹æœºæ•°ç "),
        ("å®‰è¸è¿åŠ¨æœå¥—è£…", "è¿åŠ¨æˆ·å¤–"),
        ("æ‰‹æœºæ”¯æ¶æ¡Œé¢æ‡’äººæ”¯æ¶", "æœªåˆ†ç±»"),  # åº”è¯¥è¢«æ’é™¤
        ("åä¸ºMate60 Proæ‰‹æœº", "æ‰‹æœºæ•°ç "),
        ("æå®è¿åŠ¨è£¤ç”·", "è¿åŠ¨æˆ·å¤–"),
        ("è‹¹æœiPhone15æ‰‹æœºå£³", "æœªåˆ†ç±»"),  # åº”è¯¥è¢«æ’é™¤
        ("æå®å“ç‰Œè¿åŠ¨é‹", "è¿åŠ¨æˆ·å¤–"),
        ("åä¸ºæ‰‹æœºå®˜æ–¹æ——èˆ°åº—", "æ‰‹æœºæ•°ç "),
        ("è€å…‹è¿åŠ¨é‹æ­£å“", "è¿åŠ¨æˆ·å¤–"),
    ]
    
    print("ğŸ§ª æ”¹è¿›ç‰ˆåˆ†ç±»è¯†åˆ«æµ‹è¯•:")
    correct_count = 0
    
    for title, expected in test_cases:
        result = improved_category_recognition(title)
        is_correct = result == expected
        if is_correct:
            correct_count += 1
        
        status = "âœ…" if is_correct else "âŒ"
        print(f"  {status} {title} -> {result} (æœŸæœ›: {expected})")
    
    accuracy = (correct_count / len(test_cases)) * 100
    print(f"\næµ‹è¯•å‡†ç¡®ç‡: {accuracy:.1f}% ({correct_count}/{len(test_cases)})")

def get_improvement_suggestions():
    """
    è·å–æ”¹è¿›å»ºè®®
    """
    print("\nğŸ“ˆ æé«˜åˆ†ç±»å‡†ç¡®åº¦çš„æ–¹æ³•:")
    print("1. æ·»åŠ æ’é™¤è¯è¿‡æ»¤ - é¿å…é…ä»¶è¢«é”™è¯¯åˆ†ç±»")
    print("2. å“ç‰Œä¼˜å…ˆåˆ†ç±» - åˆ©ç”¨å“ç‰Œä¿¡æ¯æé«˜å‡†ç¡®åº¦")
    print("3. å…³é”®è¯æƒé‡ç³»ç»Ÿ - é‡è¦å…³é”®è¯æƒé‡æ›´é«˜")
    print("4. å®Œæ•´åŒ¹é…åŠ åˆ† - å®Œæ•´åŒ¹é…çš„å…³é”®è¯å¾—åˆ†æ›´é«˜")
    print("5. å¤šç»´åº¦åˆ†æ - ç»“åˆæ ‡é¢˜ã€å“ç‰Œã€æè¿°ç­‰ä¿¡æ¯")
    print("6. æœºå™¨å­¦ä¹ æ¨¡å‹ - ä½¿ç”¨è®­ç»ƒå¥½çš„åˆ†ç±»æ¨¡å‹")
    print("7. ç”¨æˆ·åé¦ˆæœºåˆ¶ - æ”¶é›†ç”¨æˆ·å¯¹åˆ†ç±»çš„åé¦ˆ")
    print("8. å®šæœŸæ›´æ–°å…³é”®è¯åº“ - æ ¹æ®æ–°å•†å“æ›´æ–°å…³é”®è¯")
    print("9. åˆ†ç±»è§„åˆ™ä¼˜åŒ– - æ ¹æ®å®é™…æ•°æ®è°ƒæ•´åˆ†ç±»è§„åˆ™")
    print("10. äººå·¥å®¡æ ¸æœºåˆ¶ - å¯¹ä¸ç¡®å®šçš„åˆ†ç±»è¿›è¡Œäººå·¥å®¡æ ¸")

if __name__ == "__main__":
    test_improved_classification()
    get_improvement_suggestions() 